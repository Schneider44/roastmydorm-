<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shared Apartement - Hay Mansour - RoastMyDorm</title>
    <meta name="description" content="Cozy room near university in Ain Sebaa, Casablanca. Budget-friendly student accommodation.">
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/x-icon" href="roastmydorm_logo-removebg-preview.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        .dorm-detail-page {
            min-height: 100vh;
            background: #f8fafc;
        }
        
        .dorm-header {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
            padding: 2rem 0;
            position: relative;
            overflow: hidden;
        }
        
        .dorm-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('app hay mansour.png') center/cover;
            opacity: 0.1;
            z-index: 1;
        }
        
        .dorm-header-content {
            position: relative;
            z-index: 2;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }
        
        .dorm-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .dorm-location {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 1rem;
        }
        
        .dorm-rating {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.1rem;
        }
        
        .dorm-price {
            font-size: 2rem;
            font-weight: 700;
            color: #06b6d4;
            margin-top: 1rem;
        }
        
        .dorm-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
        }
        
        .dorm-gallery {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        .gallery-main {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 1rem;
        }
        
        .gallery-main img {
            width: 100%;
            height: 400px;
            object-fit: cover;
        }
        
        .gallery-thumbnails {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
        }
        
        .gallery-thumb {
            border-radius: 6px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .gallery-thumb:hover {
            transform: scale(1.05);
        }
        
        .gallery-thumb img {
            width: 100%;
            height: 80px;
            object-fit: cover;
        }
        
        .dorm-details {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        .detail-section {
            margin-bottom: 2rem;
        }
        
        .detail-section h3 {
            color: #1f2937;
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }
        
        .amenities-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
        }
        
        .amenity-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            background: #f8fafc;
            border-radius: 6px;
        }
        
        .amenity-item i {
            color: #06b6d4;
            width: 20px;
        }
        
        .dorm-sidebar {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .contact-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .contact-card h3 {
            margin-bottom: 1rem;
            color: #1f2937;
        }
        
        .contact-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            width: 100%;
            margin-bottom: 1rem;
        }
        
        .contact-btn:hover {
            background: #dc2626;
        }
        
        .contact-info {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: #6b7280;
        }
        
        .map-container {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .map-container h3 {
            margin-bottom: 1rem;
            color: #1f2937;
        }
        
        #map {
            height: 300px;
            border-radius: 8px;
            width: 100%;
        }
        
        .reviews-section {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        .review-item {
            border-bottom: 1px solid #e5e7eb;
            padding: 1rem 0;
        }
        
        .review-item:last-child {
            border-bottom: none;
        }
        
        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .review-author {
            font-weight: 600;
            color: #1f2937;
        }
        
        .review-date {
            color: #6b7280;
            font-size: 0.9rem;
        }
        
        .review-rating {
            color: #fbbf24;
            margin-bottom: 0.5rem;
        }
        
        .review-text {
            color: #4b5563;
            line-height: 1.6;
        }
        
        .back-btn {
            position: absolute;
            top: 2rem;
            left: 2rem;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
            z-index: 3;
        }
        
        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* Landlord Chat Modal Styles */
        .landlord-chat-modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .landlord-chat-container {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 400px;
            height: 600px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .landlord-chat-header {
            background: #06b6d4;
            color: white;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .landlord-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .landlord-info h3 {
            margin: 0;
            font-size: 1.1rem;
        }

        .landlord-info p {
            margin: 0;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .landlord-chat-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            margin-left: auto;
            padding: 0.5rem;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .landlord-chat-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .landlord-chat-messages {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .landlord-message {
            display: flex;
            gap: 0.5rem;
            align-items: flex-end;
        }

        .landlord-message.student {
            flex-direction: row-reverse;
        }

        .landlord-message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .landlord-message-avatar.student {
            background: #3b82f6;
            color: white;
        }

        .landlord-message-avatar.landlord {
            background: #06b6d4;
            color: white;
        }

        .landlord-message-bubble {
            max-width: 70%;
            padding: 0.75rem 1rem;
            border-radius: 18px;
            position: relative;
        }

        .landlord-message-bubble.student {
            background: #3b82f6;
            color: white;
            border-bottom-right-radius: 4px;
        }

        .landlord-message-bubble.landlord {
            background: #f3f4f6;
            color: #1f2937;
            border-bottom-left-radius: 4px;
        }

        .landlord-message-time {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-top: 0.25rem;
        }

        .landlord-chat-input-container {
            padding: 1rem;
            border-top: 1px solid #e5e7eb;
            display: flex;
            gap: 0.5rem;
            align-items: flex-end;
        }

        .landlord-chat-input {
            flex: 1;
            border: 1px solid #d1d5db;
            border-radius: 20px;
            padding: 0.75rem 1rem;
            resize: none;
            outline: none;
            font-family: inherit;
            font-size: 0.9rem;
            max-height: 100px;
        }

        .landlord-chat-input:focus {
            border-color: #06b6d4;
        }

        .landlord-chat-send {
            background: #06b6d4;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.2s;
        }

        .landlord-chat-send:hover {
            background: #0891b2;
        }

        .landlord-typing-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-style: italic;
            color: #6b7280;
        }

        .landlord-typing-dots {
            display: flex;
            gap: 2px;
        }

        .landlord-typing-dot {
            width: 4px;
            height: 4px;
            background: #6b7280;
            border-radius: 50%;
            animation: landlord-typing 1.4s infinite ease-in-out;
        }

        .landlord-typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .landlord-typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes landlord-typing {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        @media (max-width: 768px) {
            .dorm-content {
                grid-template-columns: 1fr;
                padding: 1rem;
            }
            
            .dorm-title {
                font-size: 2rem;
            }
            
            .gallery-thumbnails {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .amenities-grid {
                grid-template-columns: 1fr;
            }

            .landlord-chat-container {
                width: calc(100% - 40px);
                height: calc(100% - 40px);
                bottom: 20px;
                right: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-social">
                <a href="#" class="social-icon"><i class="fab fa-instagram"></i></a>
                <a href="#" class="social-icon"><i class="fab fa-tiktok"></i></a>
            </div>
            <div class="nav-logo">
                <a href="index.html" style="text-decoration: none; color: inherit;">
                    <span>RoastMyDorm</span>
                </a>
            </div>
            <div class="nav-menu">
                <button class="nav-btn">Sign In</button>
            </div>
            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <div class="dorm-detail-page">
        <!-- Breadcrumb -->
        <div class="breadcrumb" style="background: #f8fafc; padding: 1rem 2rem; border-bottom: 1px solid #e5e7eb;">
            <div style="max-width: 1200px; margin: 0 auto;">
                <a href="index.html" style="color: #6b7280; text-decoration: none;">Home</a>
                <span style="margin: 0 0.5rem; color: #9ca3af;">></span>
                <a href="casablanca-dorms.html" style="color: #6b7280; text-decoration: none;">Casablanca Dorms</a>
                <span style="margin: 0 0.5rem; color: #9ca3af;">></span>
                <span style="color: #1f2937; font-weight: 500;">shared apartement-Hay Mansour</span>
            </div>
        </div>

        <!-- Header -->
        <div class="dorm-header">
            <button class="back-btn" onclick="history.back()">
                <i class="fas fa-arrow-left"></i> Back
            </button>
            <div class="dorm-header-content">
                <h1 class="dorm-title">shared apartement - Hay Mansour</h1>
                <p class="dorm-location">
                    <i class="fas fa-map-marker-alt"></i>
                    Ain Sebaa, Casablanca • 12 min walk to Hassan II University
                </p>
                <div class="dorm-rating">
                    <div class="stars">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="far fa-star"></i>
                    </div>
                    <span>4.1/5 (12 reviews)</span>
                </div>
                <div class="dorm-price">1,500 MAD/month</div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="dorm-content">
            <!-- Left Column -->
            <div class="main-content">
                <!-- Image Gallery -->
                <div class="dorm-gallery">
                    <h3>Photos</h3>
                    <div class="gallery-main">
                        <img id="mainImage" src="app hay mansour.png" alt="Cozy Room Main View">
                    </div>
                    <div class="gallery-thumbnails">
                        <div class="gallery-thumb" onclick="changeMainImage('app hay mansour 2.png')">
                            <img src="app hay mansour 2.png" alt="Room">
                        </div>
                        <div class="gallery-thumb" onclick="changeMainImage('app hay mansour 4.png')">
                            <img src="app hay mansour 4.png" alt="Study Area">
                        </div>
                        <div class="gallery-thumb" onclick="changeMainImage('app hay mansour 3.png')">
                            <img src="app hay mansour 3.png" alt="Shared Kitchen">
                        </div>
                        <div class="gallery-thumb" onclick="changeMainImage('app hay mansour 3.png')">
                            <img src="app hay mansour 3.png" alt="Common Area">
                        </div>
                    </div>
                </div>

                <!-- Dorm Details -->
                <div class="dorm-details">
                    <div class="detail-section">
                        <h3>About this place</h3>
                        <p>This cozy room in Ain Sebaa offers excellent value for money for students on a tight budget. The room is comfortable and well-maintained, perfect for focused studying.</p>
                        <p>Located in a quiet residential area, you'll enjoy a peaceful environment while still being close to the university and essential amenities.</p>
                    </div>

                    <div class="detail-section">
                        <h3>Amenities</h3>
                        <div class="amenities-grid">
                            <div class="amenity-item">
                                <i class="fas fa-wifi"></i>
                                <span>Free WiFi</span>
                            </div>
                            <div class="amenity-item">
                                <i class="fas fa-shield-alt"></i>
                                <span>24/7 Security</span>
                            </div>
                            <div class="amenity-item">
                                <i class="fas fa-bed"></i>
                                <span>Single Bed</span>
                            </div>
                            <div class="amenity-item">
                                <i class="fas fa-desk"></i>
                                <span>Study Desk</span>
                            </div>
                        </div>
                    </div>

                    <div class="detail-section">
                        <h3>What's included</h3>
                        <ul style="list-style: none; padding: 0;">
                            <li style="margin-bottom: 0.5rem;"><i class="fas fa-check" style="color: #06b6d4; margin-right: 0.5rem;"></i> WiFi internet</li>
                            <li style="margin-bottom: 0.5rem;"><i class="fas fa-check" style="color: #06b6d4; margin-right: 0.5rem;"></i> Basic furniture</li>
                            <li style="margin-bottom: 0.5rem;"><i class="fas fa-check" style="color: #06b6d4; margin-right: 0.5rem;"></i> Shared utilities</li>
                            <li style="margin-bottom: 0.5rem;"><i class="fas fa-check" style="color: #06b6d4; margin-right: 0.5rem;"></i> Security service</li>
                        </ul>
                    </div>

                    <div class="detail-section">
                        <h3>House rules</h3>
                        <ul style="list-style: none; padding: 0;">
                            <li style="margin-bottom: 0.5rem;"><i class="fas fa-times" style="color: #ef4444; margin-right: 0.5rem;"></i> No smoking</li>
                            <li style="margin-bottom: 0.5rem;"><i class="fas fa-times" style="color: #ef4444; margin-right: 0.5rem;"></i> No pets</li>
                            <li style="margin-bottom: 0.5rem;"><i class="fas fa-clock" style="color: #f59e0b; margin-right: 0.5rem;"></i> Quiet hours: 10 PM - 7 AM</li>
                            <li style="margin-bottom: 0.5rem;"><i class="fas fa-users" style="color: #3b82f6; margin-right: 0.5rem;"></i> Respect shared spaces</li>
                        </ul>
                    </div>
                </div>

                <!-- Reviews Section -->
                <div class="reviews-section">
                    <h3>Student Reviews (12)</h3>
                    
                    <div class="review-item">
                        <div class="review-header">
                            <span class="review-author">Ibrahim H.</span>
                            <span class="review-date">3 weeks ago</span>
                        </div>
                        <div class="review-rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="far fa-star"></i>
                        </div>
                        <p class="review-text">Great value for money! The room is clean and comfortable. Perfect for students who want to save money while having a decent place to live and study.</p>
                    </div>

                    <div class="review-item">
                        <div class="review-header">
                            <span class="review-author">Zineb A.</span>
                            <span class="review-date">1 month ago</span>
                        </div>
                        <div class="review-rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                        </div>
                        <p class="review-text">Excellent budget option! The room is cozy and the WiFi is reliable. The landlord is very helpful and the location is convenient for university students.</p>
                    </div>
                </div>
            </div>

            <!-- Right Sidebar -->
            <div class="dorm-sidebar">
                <!-- Contact Card -->
                <div class="contact-card">
                    <h3>Contact Landlord</h3>
                    <button class="contact-btn" onclick="contactLandlord()">
                        <i class="fas fa-phone"></i> Call Now
                    </button>
                    <button class="contact-btn" onclick="openLandlordChat({
                        id: 'landlord_5',
                        name: 'Rachid',
                        availability: 'Available 8 AM - 6 PM',
                        phone: '+212 6 56 78 90 12',
                        email: 'rachid.benali@email.com'
                    }, {
                        id: 'listing_5',
                        title: 'Cozy Room Near University',
                        price: '1,500 MAD/month'
                    })" style="background: #3b82f6;">
                        <i class="fas fa-envelope"></i> Send Message
                    </button>
                    <button class="contact-btn" onclick="window.location.href='review-form.html'" style="background: #f59e0b;">
                        <i class="fas fa-star"></i> Write Review
                    </button>
                    <div class="contact-info">
                        <p><i class="fas fa-user"></i> Rachid Benali</p>
                        <p><i class="fas fa-phone"></i> +212 6 56 78 90 12</p>
                        <p><i class="fas fa-envelope"></i> rachid.benali@email.com</p>
                        <p><i class="fas fa-clock"></i> Available 8 AM - 6 PM</p>
                    </div>
                </div>

                <!-- Map -->
                <div class="map-container">
                    <h3>Location</h3>
                    <div id="map"></div>
                    <p style="margin-top: 1rem; font-size: 0.9rem; color: #6b7280;">
                        <i class="fas fa-walking"></i> 12 min walk to Hassan II University<br>
                        <i class="fas fa-bus"></i> 4 min walk to bus stop<br>
                        <i class="fas fa-store"></i> 6 min walk to local shops
                    </p>
                </div>
            </div>
        </div>

        <!-- Navigation Footer -->
        <div class="navigation-footer" style="background: #f8fafc; padding: 2rem; border-top: 1px solid #e5e7eb; margin-top: 2rem;">
            <div style="max-width: 1200px; margin: 0 auto; text-align: center;">
                <h3 style="margin-bottom: 1rem; color: #1f2937;">Explore More Options</h3>
                <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                    <button class="btn-secondary" onclick="window.location.href='casablanca-dorms.html'" style="padding: 12px 24px; border: 2px solid #3b82f6; color: #3b82f6; background: white; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        <i class="fas fa-building"></i> All Casablanca Dorms
                    </button>
                    <button class="btn-secondary" onclick="window.location.href='rabat-dorms.html'" style="padding: 12px 24px; border: 2px solid #10b981; color: #10b981; background: white; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        <i class="fas fa-map-marker-alt"></i> Rabat Dorms
                    </button>
                    <button class="btn-secondary" onclick="window.location.href='marrakech-dorms.html'" style="padding: 12px 24px; border: 2px solid #f59e0b; color: #f59e0b; background: white; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        <i class="fas fa-sun"></i> Marrakech Dorms
                    </button>
                    <button class="btn-primary" onclick="window.location.href='index.html'" style="padding: 12px 24px; background: #ef4444; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        <i class="fas fa-home"></i> Back to Home
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Landlord Chat Modal -->
    <div id="landlordChatModal" class="landlord-chat-modal">
        <div class="landlord-chat-container">
            <div class="landlord-chat-header">
                <div class="landlord-avatar" id="landlordAvatar">R</div>
                <div class="landlord-info">
                    <h3 id="landlordName">Rachid</h3>
                    <p id="landlordStatus">Available 8 AM - 6 PM</p>
                </div>
                <button class="landlord-chat-close" onclick="closeLandlordChat()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="landlord-chat-messages" id="landlordChatMessages">
                <!-- Messages will be loaded here -->
            </div>
            
            <div class="landlord-chat-input-container">
                <textarea 
                    class="landlord-chat-input" 
                    id="landlordChatInput" 
                    placeholder="Type your message..."
                    rows="1"
                    onkeypress="handleLandlordKeyPress(event)"
                    oninput="autoResizeLandlordInput(this)"
                ></textarea>
                <button class="landlord-chat-send" onclick="sendLandlordMessage()" id="landlordSendBtn">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="script.js"></script>
    <script>
        // Image gallery functionality
        function changeMainImage(imageSrc) {
            document.getElementById('mainImage').src = imageSrc;
        }

        // Contact functions
        function contactLandlord() {
            alert('Calling Rachid Benali at +212 6 56 78 90 12');
        }

        // Landlord Chat System
        class LandlordChat {
            constructor() {
                this.currentChatId = null;
                this.currentLandlord = null;
                this.currentListing = null;
                this.messages = [];
                this.isOpen = false;
                this.init();
            }

            init() {
                // Initialize chat system
            }

            openChat(landlordInfo, listingInfo) {
                this.currentLandlord = landlordInfo;
                this.currentListing = listingInfo;
                this.currentChatId = this.generateChatId();
                
                // Update header with landlord info
                document.getElementById('landlordName').textContent = landlordInfo.name;
                document.getElementById('landlordStatus').textContent = landlordInfo.availability || 'Available';
                document.getElementById('landlordAvatar').textContent = landlordInfo.name.charAt(0).toUpperCase();
                
                // Show modal
                document.getElementById('landlordChatModal').style.display = 'block';
                document.body.style.overflow = 'hidden';
                this.isOpen = true;
                
                // Load chat history
                this.loadChatHistory();
                
                // Focus input
                document.getElementById('landlordChatInput').focus();
            }

            closeChat() {
                document.getElementById('landlordChatModal').style.display = 'none';
                document.body.style.overflow = 'auto';
                this.isOpen = false;
                this.currentChatId = null;
                this.currentLandlord = null;
                this.currentListing = null;
                this.messages = [];
            }

            generateChatId() {
                const studentId = this.getCurrentStudentId();
                const landlordId = this.currentLandlord.id;
                const listingId = this.currentListing.id;
                return `${studentId}_${landlordId}_${listingId}`;
            }

            getCurrentStudentId() {
                return 'student_' + Date.now();
            }

            sendMessage() {
                const input = document.getElementById('landlordChatInput');
                const message = input.value.trim();
                
                if (!message) return;

                const messageData = {
                    id: Date.now(),
                    text: message,
                    sender: 'student',
                    senderId: this.getCurrentStudentId(),
                    timestamp: new Date().toISOString(),
                    chatId: this.currentChatId,
                    listingId: this.currentListing.id,
                    landlordId: this.currentLandlord.id
                };

                this.addMessageToUI(messageData);
                this.saveMessageToFirebase(messageData);
                
                input.value = '';
                this.autoResize(input);
                this.simulateLandlordResponse();
            }

            addMessageToUI(message) {
                const messagesContainer = document.getElementById('landlordChatMessages');
                const messageDiv = document.createElement('div');
                messageDiv.className = `landlord-message ${message.sender}`;
                
                const avatar = document.createElement('div');
                avatar.className = `landlord-message-avatar ${message.sender}`;
                avatar.textContent = message.sender === 'student' ? 'S' : this.currentLandlord.name.charAt(0).toUpperCase();
                
                const bubble = document.createElement('div');
                bubble.className = `landlord-message-bubble ${message.sender}`;
                bubble.innerHTML = `
                    ${message.text}
                    <div class="landlord-message-time">${this.formatTime(message.timestamp)}</div>
                `;
                
                messageDiv.appendChild(avatar);
                messageDiv.appendChild(bubble);
                messagesContainer.appendChild(messageDiv);
                
                this.scrollToBottom();
            }

            simulateLandlordResponse() {
                this.showTypingIndicator();
                
                setTimeout(() => {
                    this.hideTypingIndicator();
                    const response = this.generateLandlordResponse();
                    const responseData = {
                        id: Date.now(),
                        text: response,
                        sender: 'landlord',
                        senderId: this.currentLandlord.id,
                        timestamp: new Date().toISOString(),
                        chatId: this.currentChatId,
                        listingId: this.currentListing.id,
                        landlordId: this.currentLandlord.id
                    };
                    
                    this.addMessageToUI(responseData);
                    this.saveMessageToFirebase(responseData);
                }, 1500 + Math.random() * 2000);
            }

            generateLandlordResponse() {
                const responses = [
                    "Hello! Thanks for your interest in my property. How can I help you?",
                    "Hi there! I'm available to answer any questions about the apartment.",
                    "Hello! Are you interested in scheduling a viewing?",
                    "Hi! The apartment is still available. Would you like to know more details?",
                    "Hello! I can provide more photos or arrange a virtual tour if you'd like.",
                    "Hi there! The rent includes all utilities and WiFi. Any other questions?",
                    "Hello! I'm flexible with move-in dates. What works best for you?",
                    "Hi! The apartment is fully furnished and ready to move in. Interested?"
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }

            showTypingIndicator() {
                const messagesContainer = document.getElementById('landlordChatMessages');
                const typingDiv = document.createElement('div');
                typingDiv.className = 'landlord-message landlord';
                typingDiv.id = 'landlordTypingIndicator';
                typingDiv.innerHTML = `
                    <div class="landlord-message-avatar landlord">${this.currentLandlord.name.charAt(0).toUpperCase()}</div>
                    <div class="landlord-message-bubble landlord">
                        <div class="landlord-typing-indicator">
                            ${this.currentLandlord.name} is typing
                            <div class="landlord-typing-dots">
                                <div class="landlord-typing-dot"></div>
                                <div class="landlord-typing-dot"></div>
                                <div class="landlord-typing-dot"></div>
                            </div>
                        </div>
                    </div>
                `;
                messagesContainer.appendChild(typingDiv);
                this.scrollToBottom();
            }

            hideTypingIndicator() {
                const typingIndicator = document.getElementById('landlordTypingIndicator');
                if (typingIndicator) {
                    typingIndicator.remove();
                }
            }

            loadChatHistory() {
                const messagesContainer = document.getElementById('landlordChatMessages');
                messagesContainer.innerHTML = '';
                
                const welcomeMessage = {
                    id: Date.now(),
                    text: `Hello! I'm ${this.currentLandlord.name}, the landlord for this property. How can I help you today?`,
                    sender: 'landlord',
                    timestamp: new Date().toISOString()
                };
                
                this.addMessageToUI(welcomeMessage);
            }

            saveMessageToFirebase(messageData) {
                console.log('Saving message to Firebase:', messageData);
                
                try {
                    const existingMessages = JSON.parse(localStorage.getItem(`landlord_chat_${this.currentChatId}`) || '[]');
                    existingMessages.push(messageData);
                    localStorage.setItem(`landlord_chat_${this.currentChatId}`, JSON.stringify(existingMessages));
                } catch (error) {
                    console.error('Error saving message:', error);
                }
            }

            formatTime(timestamp) {
                const now = new Date();
                const time = new Date(timestamp);
                const diff = now - time;
                
                if (diff < 60000) return 'Just now';
                if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;
                if (diff < 86400000) return `${Math.floor(diff / 3600000)}h ago`;
                return time.toLocaleDateString();
            }

            scrollToBottom() {
                const messagesContainer = document.getElementById('landlordChatMessages');
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }

            autoResize(textarea) {
                textarea.style.height = 'auto';
                textarea.style.height = Math.min(textarea.scrollHeight, 100) + 'px';
            }

            handleKeyPress(event) {
                if (event.key === 'Enter' && !event.shiftKey) {
                    event.preventDefault();
                    this.sendMessage();
                }
            }
        }

        // Initialize landlord chat
        let landlordChat;
        document.addEventListener('DOMContentLoaded', function() {
            landlordChat = new LandlordChat();
        });

        // Global functions
        function openLandlordChat(landlordInfo, listingInfo) {
            landlordChat.openChat(landlordInfo, listingInfo);
        }

        function closeLandlordChat() {
            landlordChat.closeChat();
        }

        function sendLandlordMessage() {
            landlordChat.sendMessage();
        }

        function handleLandlordKeyPress(event) {
            landlordChat.handleKeyPress(event);
        }

        function autoResizeLandlordInput(textarea) {
            landlordChat.autoResize(textarea);
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('landlordChatModal');
            if (event.target === modal) {
                closeLandlordChat();
            }
        }

        // Close modal with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape' && landlordChat.isOpen) {
                closeLandlordChat();
            }
        });

        // Initialize map
        document.addEventListener('DOMContentLoaded', function() {
            // Ain Sebaa, Casablanca coordinates (approximate)
            const map = L.map('map').setView([33.5731, -7.5898], 15);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);

            // Add markers
            L.marker([33.5731, -7.5898]).addTo(map)
                .bindPopup('Hassan II University')
                .openPopup();

            L.marker([33.5725, -7.5905]).addTo(map)
                .bindPopup('Cozy Room - Hay Mansour')
                .openPopup();
        });
    </script>
</body>
</html>
