<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Student Housing | RoastMyDorm</title>
    <meta name="description" id="meta-description" content="">
    
    <!-- Open Graph -->
    <meta property="og:title" id="og-title" content="">
    <meta property="og:description" id="og-description" content="">
    <meta property="og:type" content="website">
    <meta property="og:url" id="og-url" content="">
    <meta property="og:image" id="og-image" content="">
    
    <link rel="canonical" id="canonical-url" href="">
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/x-icon" href="roastmydorm_logo-removebg-preview.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="js/seo-utils.js" defer></script>
    
    <style>
        .city-hero {
            background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.6)), 
                        url('images/city-placeholder.jpg') center/cover;
            padding: 100px 24px;
            text-align: center;
            color: white;
        }

        .city-hero h1 {
            font-size: 3rem;
            margin-bottom: 16px;
            font-weight: 700;
        }

        .city-hero p {
            font-size: 1.25rem;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto 24px;
        }

        .city-stats {
            display: flex;
            justify-content: center;
            gap: 48px;
            flex-wrap: wrap;
        }

        .city-stat {
            text-align: center;
        }

        .city-stat-value {
            font-size: 2.5rem;
            font-weight: 700;
        }

        .city-stat-label {
            font-size: 0.875rem;
            opacity: 0.8;
        }

        .city-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 48px 24px;
        }

        /* Breadcrumb */
        .breadcrumb {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-bottom: 32px;
            color: #6b7280;
            font-size: 0.875rem;
        }

        .breadcrumb a {
            color: #6b7280;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            color: #667eea;
        }

        /* Filter Section */
        .filter-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            margin-bottom: 32px;
        }

        .filter-row {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-label {
            display: block;
            font-size: 0.875rem;
            color: #374151;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .filter-select,
        .filter-input {
            width: 100%;
            padding: 10px 14px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .filter-select:focus,
        .filter-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .filter-btn {
            padding: 10px 24px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            align-self: flex-end;
        }

        .filter-btn:hover {
            opacity: 0.9;
        }

        /* Layout */
        .city-layout {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 32px;
        }

        .city-main {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .city-sidebar {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        /* Dorm Grid */
        .dorm-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 24px;
        }

        .dorm-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .dorm-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .dorm-card-image {
            position: relative;
            height: 180px;
        }

        .dorm-card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .dorm-badge {
            position: absolute;
            top: 12px;
            left: 12px;
            background: #10b981;
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .dorm-badge.featured {
            background: linear-gradient(135deg, #f59e0b, #f97316);
        }

        .dorm-favorite {
            position: absolute;
            top: 12px;
            right: 12px;
            background: white;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            transition: transform 0.2s;
        }

        .dorm-favorite:hover {
            transform: scale(1.1);
        }

        .dorm-favorite i {
            color: #ef4444;
            font-size: 1rem;
        }

        .dorm-card-content {
            padding: 16px;
        }

        .dorm-card-title {
            font-size: 1.125rem;
            color: #1f2937;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .dorm-card-title a {
            color: inherit;
            text-decoration: none;
        }

        .dorm-card-title a:hover {
            color: #667eea;
        }

        .dorm-card-location {
            display: flex;
            align-items: center;
            gap: 6px;
            color: #6b7280;
            font-size: 0.875rem;
            margin-bottom: 12px;
        }

        .dorm-card-rating {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .rating-stars {
            color: #f59e0b;
        }

        .rating-value {
            font-weight: 600;
            color: #374151;
        }

        .rating-count {
            color: #9ca3af;
            font-size: 0.875rem;
        }

        .dorm-card-price {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .price-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: #667eea;
        }

        .price-period {
            color: #9ca3af;
            font-size: 0.875rem;
        }

        .dorm-card-amenities {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap;
        }

        .amenity-tag {
            padding: 4px 10px;
            background: #f3f4f6;
            border-radius: 20px;
            font-size: 0.75rem;
            color: #6b7280;
        }

        /* Sidebar Sections */
        .sidebar-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }

        .sidebar-title {
            font-size: 1.125rem;
            color: #1f2937;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Universities List */
        .university-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .university-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #f9fafb;
            border-radius: 8px;
            text-decoration: none;
            color: #374151;
            transition: background 0.2s;
        }

        .university-item:hover {
            background: #f3f4f6;
        }

        .university-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .university-info {
            flex: 1;
        }

        .university-name {
            font-weight: 600;
            font-size: 0.875rem;
        }

        .university-dorms {
            font-size: 0.75rem;
            color: #9ca3af;
        }

        /* Neighborhoods */
        .neighborhood-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .neighborhood-link {
            padding: 10px 14px;
            background: #f9fafb;
            border-radius: 8px;
            text-decoration: none;
            color: #374151;
            font-size: 0.875rem;
            text-align: center;
            transition: background 0.2s;
        }

        .neighborhood-link:hover {
            background: #667eea;
            color: white;
        }

        /* City Info */
        .city-info-grid {
            display: grid;
            gap: 12px;
        }

        .city-info-item {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            background: #f9fafb;
            border-radius: 8px;
        }

        .city-info-label {
            color: #6b7280;
            font-size: 0.875rem;
        }

        .city-info-value {
            font-weight: 600;
            color: #1f2937;
        }

        /* FAQ Section */
        .faq-section {
            margin-top: 48px;
        }

        .faq-title {
            font-size: 1.75rem;
            color: #1f2937;
            margin-bottom: 24px;
        }

        .faq-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .faq-item {
            background: white;
            border-radius: 12px;
            padding: 20px 24px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            cursor: pointer;
        }

        .faq-question {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            color: #1f2937;
        }

        .faq-answer {
            margin-top: 12px;
            color: #6b7280;
            line-height: 1.6;
            display: none;
        }

        .faq-item.active .faq-answer {
            display: block;
        }

        .faq-item.active .faq-toggle {
            transform: rotate(180deg);
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 32px;
        }

        .pagination-btn {
            padding: 10px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            background: white;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s;
        }

        .pagination-btn:hover,
        .pagination-btn.active {
            background: #667eea;
            border-color: #667eea;
            color: white;
        }

        /* Internal Links Section */
        .internal-links {
            background: #f9fafb;
            padding: 48px 24px;
            margin-top: 48px;
        }

        .internal-links-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .internal-links h2 {
            font-size: 1.5rem;
            color: #1f2937;
            margin-bottom: 24px;
        }

        .links-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 24px;
        }

        .links-column h3 {
            font-size: 1rem;
            color: #374151;
            margin-bottom: 12px;
        }

        .links-column a {
            display: block;
            color: #6b7280;
            text-decoration: none;
            font-size: 0.875rem;
            padding: 4px 0;
            transition: color 0.2s;
        }

        .links-column a:hover {
            color: #667eea;
        }

        @media (max-width: 900px) {
            .city-layout {
                grid-template-columns: 1fr;
            }

            .city-sidebar {
                order: -1;
            }

            .city-hero h1 {
                font-size: 2rem;
            }

            .links-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 640px) {
            .dorm-grid {
                grid-template-columns: 1fr;
            }

            .filter-row {
                flex-direction: column;
            }

            .filter-group {
                min-width: 100%;
            }

            .city-stats {
                gap: 24px;
            }

            .links-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="logo">
                <img src="roastmydorm_logo-removebg-preview.png" alt="RoastMyDorm">
                <span>RoastMyDorm</span>
            </a>
            <div class="nav-links">
                <a href="how-it-works.html" class="nav-link">How It Works</a>
                <a href="for-students.html" class="nav-link">For Students</a>
                <a href="blog.html" class="nav-link">Blog</a>
                <a href="find-roommate-profile.html" class="nav-link">Find Roommate</a>
                <button class="sign-in-btn" onclick="window.location.href='login.html'">Sign In</button>
            </div>
        </div>
    </nav>

    <!-- Hero Section (will be populated dynamically) -->
    <section class="city-hero" id="city-hero">
        <h1 id="city-title">Loading...</h1>
        <p id="city-description">Finding the best student housing options</p>
        <div class="city-stats" id="city-stats">
            <div class="city-stat">
                <div class="city-stat-value" id="stat-listings">-</div>
                <div class="city-stat-label">Available Listings</div>
            </div>
            <div class="city-stat">
                <div class="city-stat-value" id="stat-avg-price">-</div>
                <div class="city-stat-label">Avg. Price/Month</div>
            </div>
            <div class="city-stat">
                <div class="city-stat-value" id="stat-universities">-</div>
                <div class="city-stat-label">Universities</div>
            </div>
        </div>
    </section>

    <main class="city-container">
        <!-- Breadcrumb -->
        <nav class="breadcrumb" id="breadcrumb" aria-label="Breadcrumb">
            <a href="index.html">Home</a>
            <span>/</span>
            <a href="cities.html">Cities</a>
            <span>/</span>
            <span id="breadcrumb-city">Loading...</span>
        </nav>

        <!-- Filters -->
        <div class="filter-section">
            <div class="filter-row">
                <div class="filter-group">
                    <label class="filter-label">Price Range</label>
                    <select class="filter-select" id="filter-price">
                        <option value="">Any Price</option>
                        <option value="0-2000">Under 2,000 MAD</option>
                        <option value="2000-4000">2,000 - 4,000 MAD</option>
                        <option value="4000-6000">4,000 - 6,000 MAD</option>
                        <option value="6000+">6,000+ MAD</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Property Type</label>
                    <select class="filter-select" id="filter-type">
                        <option value="">All Types</option>
                        <option value="studio">Studio</option>
                        <option value="apartment">Apartment</option>
                        <option value="shared">Shared Room</option>
                        <option value="dorm">Dorm Room</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Neighborhood</label>
                    <select class="filter-select" id="filter-neighborhood">
                        <option value="">All Neighborhoods</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Sort By</label>
                    <select class="filter-select" id="filter-sort">
                        <option value="recommended">Recommended</option>
                        <option value="price-low">Price: Low to High</option>
                        <option value="price-high">Price: High to Low</option>
                        <option value="rating">Highest Rated</option>
                        <option value="newest">Newest</option>
                    </select>
                </div>
                <button class="filter-btn" onclick="applyFilters()">
                    <i class="fas fa-search"></i> Search
                </button>
            </div>
        </div>

        <!-- Main Layout -->
        <div class="city-layout">
            <div class="city-main">
                <!-- Dorm Grid -->
                <div class="dorm-grid" id="dorm-grid">
                    <p style="grid-column: 1/-1; text-align: center; padding: 40px;">
                        <i class="fas fa-spinner fa-spin"></i> Loading listings...
                    </p>
                </div>

                <!-- Pagination -->
                <div class="pagination" id="pagination"></div>
            </div>

            <aside class="city-sidebar">
                <!-- Universities -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title">
                        <i class="fas fa-university"></i> Universities
                    </h3>
                    <div class="university-list" id="university-list">
                        <p><i class="fas fa-spinner fa-spin"></i> Loading...</p>
                    </div>
                </div>

                <!-- Neighborhoods -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title">
                        <i class="fas fa-map-marker-alt"></i> Neighborhoods
                    </h3>
                    <div class="neighborhood-grid" id="neighborhood-grid">
                        <p><i class="fas fa-spinner fa-spin"></i></p>
                    </div>
                </div>

                <!-- City Info -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title">
                        <i class="fas fa-info-circle"></i> Housing Info
                    </h3>
                    <div class="city-info-grid" id="city-info">
                        <div class="city-info-item">
                            <span class="city-info-label">Average Rent</span>
                            <span class="city-info-value" id="info-avg-rent">-</span>
                        </div>
                        <div class="city-info-item">
                            <span class="city-info-label">Median Rent</span>
                            <span class="city-info-value" id="info-median-rent">-</span>
                        </div>
                        <div class="city-info-item">
                            <span class="city-info-label">Popular Type</span>
                            <span class="city-info-value" id="info-popular-type">-</span>
                        </div>
                    </div>
                </div>
            </aside>
        </div>

        <!-- FAQ Section -->
        <section class="faq-section">
            <h2 class="faq-title">Frequently Asked Questions</h2>
            <div class="faq-list" id="faq-list">
                <!-- FAQs will be populated -->
            </div>
        </section>
    </main>

    <!-- Internal Links -->
    <section class="internal-links">
        <div class="internal-links-container">
            <h2>Explore More Housing Options</h2>
            <div class="links-grid" id="internal-links">
                <div class="links-column">
                    <h3>Other Cities</h3>
                    <a href="/city/rabat-student-housing">Rabat Student Housing</a>
                    <a href="/city/casablanca-student-housing">Casablanca Student Housing</a>
                    <a href="/city/marrakech-student-housing">Marrakech Student Housing</a>
                    <a href="/city/fes-student-housing">Fes Student Housing</a>
                </div>
                <div class="links-column">
                    <h3>Popular Universities</h3>
                    <div id="university-links"></div>
                </div>
                <div class="links-column">
                    <h3>Housing Types</h3>
                    <a href="?type=studio">Studios</a>
                    <a href="?type=apartment">Apartments</a>
                    <a href="?type=shared">Shared Rooms</a>
                    <a href="?type=dorm">Dorm Rooms</a>
                </div>
                <div class="links-column">
                    <h3>Resources</h3>
                    <a href="blog.html">Housing Blog</a>
                    <a href="how-it-works.html">How It Works</a>
                    <a href="find-roommate-profile.html">Find a Roommate</a>
                    <a href="for-students.html">For Students</a>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>RoastMyDorm</h4>
                <p>Find and review student housing in Morocco.</p>
            </div>
            <div class="footer-section">
                <h4>Quick Links</h4>
                <a href="how-it-works.html">How It Works</a>
                <a href="for-students.html">For Students</a>
                <a href="blog.html">Blog</a>
            </div>
            <div class="footer-section">
                <h4>Cities</h4>
                <a href="casablanca-dorms.html">Casablanca</a>
                <a href="rabat-dorms.html">Rabat</a>
                <a href="marrakech-dorms.html">Marrakech</a>
            </div>
            <div class="footer-section">
                <h4>Legal</h4>
                <a href="privacy.html">Privacy Policy</a>
                <a href="terms.html">Terms of Service</a>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2026 RoastMyDorm. All rights reserved.</p>
        </div>
    </footer>

    <!-- JSON-LD Schema -->
    <script type="application/ld+json" id="page-schema"></script>

    <script>
        // Get city from URL
        const pathParts = window.location.pathname.split('/');
        let citySlug = pathParts[pathParts.length - 1].replace('.html', '').replace('-student-housing', '').replace('-dorms', '');
        
        // Also check query params
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('city')) {
            citySlug = urlParams.get('city');
        }

        let currentPage = 1;
        let cityData = null;

        // Load city data
        async function loadCityData() {
            try {
                const response = await fetch(`/api/seo/city/${citySlug}`);
                const data = await response.json();

                if (data.success) {
                    cityData = data.data;
                    renderCityInfo(cityData);
                    loadDorms();
                } else {
                    showDemoData();
                }
            } catch (error) {
                console.error('Error loading city data:', error);
                showDemoData();
            }
        }

        function renderCityInfo(data) {
            // Update page title and meta
            document.getElementById('page-title').textContent = data.metaTitle || `${data.city} Student Housing | RoastMyDorm`;
            document.getElementById('meta-description').content = data.metaDescription || `Find ${data.totalListings}+ student housing options in ${data.city}`;
            document.getElementById('og-title').content = data.metaTitle;
            document.getElementById('og-description').content = data.metaDescription;
            document.getElementById('og-url').content = `https://www.roastmydorm.com/city/${citySlug}-student-housing`;
            document.getElementById('canonical-url').href = `https://www.roastmydorm.com/city/${citySlug}-student-housing`;

            // Update hero
            document.getElementById('city-title').textContent = `Student Housing in ${data.city}`;
            document.getElementById('city-description').textContent = `Discover ${data.totalListings} verified student accommodations near top universities in ${data.city}`;
            document.getElementById('stat-listings').textContent = data.totalListings || '0';
            document.getElementById('stat-avg-price').textContent = `${formatPrice(data.averagePrice)} MAD`;
            document.getElementById('stat-universities').textContent = data.universities?.length || '0';

            // Update breadcrumb
            document.getElementById('breadcrumb-city').textContent = data.city;

            // Update sidebar info
            document.getElementById('info-avg-rent').textContent = `${formatPrice(data.averagePrice)} MAD`;
            document.getElementById('info-median-rent').textContent = `${formatPrice(data.medianPrice || data.averagePrice * 0.9)} MAD`;
            document.getElementById('info-popular-type').textContent = data.popularType || 'Studio';

            // Render universities
            renderUniversities(data.universities);

            // Render neighborhoods
            renderNeighborhoods(data.neighborhoods);

            // Render FAQs
            renderFAQs(data.city);

            // Generate JSON-LD
            generateSchema(data);
        }

        function renderUniversities(universities) {
            const container = document.getElementById('university-list');
            const linksContainer = document.getElementById('university-links');
            
            if (!universities || universities.length === 0) {
                container.innerHTML = '<p>No universities found</p>';
                return;
            }

            container.innerHTML = universities.map(uni => `
                <a href="/university/${uni.slug}-dorms" class="university-item">
                    <div class="university-icon">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                    <div class="university-info">
                        <div class="university-name">${escapeHtml(uni.name)}</div>
                        <div class="university-dorms">${uni.dormCount || 0} housing options</div>
                    </div>
                </a>
            `).join('');

            // Update internal links
            linksContainer.innerHTML = universities.slice(0, 4).map(uni => 
                `<a href="/university/${uni.slug}-dorms">${escapeHtml(uni.name)}</a>`
            ).join('');
        }

        function renderNeighborhoods(neighborhoods) {
            const container = document.getElementById('neighborhood-grid');
            const filterSelect = document.getElementById('filter-neighborhood');
            
            if (!neighborhoods || neighborhoods.length === 0) {
                container.innerHTML = '<p style="grid-column: 1/-1">No neighborhoods found</p>';
                return;
            }

            container.innerHTML = neighborhoods.map(n => 
                `<a href="?neighborhood=${n.slug}" class="neighborhood-link">${escapeHtml(n.name)}</a>`
            ).join('');

            // Update filter dropdown
            neighborhoods.forEach(n => {
                const option = document.createElement('option');
                option.value = n.slug;
                option.textContent = n.name;
                filterSelect.appendChild(option);
            });
        }

        function renderFAQs(cityName) {
            const faqs = [
                {
                    question: `What is the average rent for student housing in ${cityName}?`,
                    answer: `The average rent for student housing in ${cityName} ranges from 2,000 to 5,000 MAD per month, depending on the type of accommodation and neighborhood. Studios typically cost more than shared rooms.`
                },
                {
                    question: `How do I find roommates in ${cityName}?`,
                    answer: `RoastMyDorm offers a free roommate matching service. Create a profile with your preferences, and we'll connect you with compatible students looking for housing in ${cityName}.`
                },
                {
                    question: `Which neighborhoods are best for students in ${cityName}?`,
                    answer: `The best neighborhoods depend on your university location. Areas close to major universities tend to have more student-friendly housing options, cafes, and public transportation.`
                },
                {
                    question: `When should I start looking for student housing in ${cityName}?`,
                    answer: `We recommend starting your search 2-3 months before the academic year begins. Popular listings get taken quickly, especially in September.`
                },
                {
                    question: `Are utilities included in the rent?`,
                    answer: `It varies by listing. Some landlords include water and electricity in the rent, while others charge separately. Always check the listing details or ask the landlord directly.`
                }
            ];

            const container = document.getElementById('faq-list');
            container.innerHTML = faqs.map((faq, i) => `
                <div class="faq-item" onclick="toggleFaq(${i})">
                    <div class="faq-question">
                        <span>${escapeHtml(faq.question)}</span>
                        <i class="fas fa-chevron-down faq-toggle"></i>
                    </div>
                    <div class="faq-answer">${faq.answer}</div>
                </div>
            `).join('');

            // Add FAQ schema
            const faqSchema = {
                "@context": "https://schema.org",
                "@type": "FAQPage",
                "mainEntity": faqs.map(faq => ({
                    "@type": "Question",
                    "name": faq.question,
                    "acceptedAnswer": {
                        "@type": "Answer",
                        "text": faq.answer
                    }
                }))
            };

            const existingSchema = JSON.parse(document.getElementById('page-schema').textContent || '{}');
            document.getElementById('page-schema').textContent = JSON.stringify([existingSchema, faqSchema]);
        }

        function toggleFaq(index) {
            const items = document.querySelectorAll('.faq-item');
            items[index].classList.toggle('active');
        }

        async function loadDorms() {
            const filters = getFilters();
            
            try {
                const params = new URLSearchParams({
                    city: citySlug,
                    page: currentPage,
                    limit: 8,
                    ...filters
                });

                const response = await fetch(`/api/dorms?${params}`);
                const data = await response.json();

                if (data.success) {
                    renderDorms(data.data.dorms);
                    renderPagination(data.data.pagination);
                } else {
                    showDemoDorms();
                }
            } catch (error) {
                console.error('Error loading dorms:', error);
                showDemoDorms();
            }
        }

        function getFilters() {
            return {
                priceRange: document.getElementById('filter-price').value,
                type: document.getElementById('filter-type').value,
                neighborhood: document.getElementById('filter-neighborhood').value,
                sort: document.getElementById('filter-sort').value
            };
        }

        function applyFilters() {
            currentPage = 1;
            loadDorms();
        }

        function renderDorms(dorms) {
            const container = document.getElementById('dorm-grid');
            
            if (!dorms || dorms.length === 0) {
                container.innerHTML = '<p style="grid-column: 1/-1; text-align: center; padding: 40px;">No listings found. Try adjusting your filters.</p>';
                return;
            }

            container.innerHTML = dorms.map(dorm => `
                <article class="dorm-card">
                    <div class="dorm-card-image">
                        <img src="${dorm.images?.[0]?.url || 'images/placeholder-dorm.jpg'}" 
                             alt="${escapeHtml(dorm.name)}"
                             loading="lazy">
                        ${dorm.featured ? '<span class="dorm-badge featured">Featured</span>' : ''}
                        ${dorm.verified ? '<span class="dorm-badge">Verified</span>' : ''}
                        <button class="dorm-favorite" onclick="toggleFavorite('${dorm._id}')" aria-label="Add to favorites">
                            <i class="far fa-heart"></i>
                        </button>
                    </div>
                    <div class="dorm-card-content">
                        <h3 class="dorm-card-title">
                            <a href="/dorm/${dorm.slug}">${escapeHtml(dorm.name)}</a>
                        </h3>
                        <div class="dorm-card-location">
                            <i class="fas fa-map-marker-alt"></i>
                            ${escapeHtml(dorm.neighborhood || dorm.address?.neighborhood || citySlug)}
                        </div>
                        <div class="dorm-card-rating">
                            <span class="rating-stars">${renderStars(dorm.averageRating)}</span>
                            <span class="rating-value">${(dorm.averageRating || 0).toFixed(1)}</span>
                            <span class="rating-count">(${dorm.reviewCount || 0} reviews)</span>
                        </div>
                        <div class="dorm-card-price">
                            <span>
                                <span class="price-value">${formatPrice(dorm.price)} MAD</span>
                                <span class="price-period">/month</span>
                            </span>
                        </div>
                        ${dorm.amenities?.length ? `
                            <div class="dorm-card-amenities">
                                ${dorm.amenities.slice(0, 3).map(a => 
                                    `<span class="amenity-tag">${a}</span>`
                                ).join('')}
                            </div>
                        ` : ''}
                    </div>
                </article>
            `).join('');
        }

        function renderPagination(pagination) {
            const container = document.getElementById('pagination');
            
            if (!pagination || pagination.totalPages <= 1) {
                container.innerHTML = '';
                return;
            }

            let html = `
                <button class="pagination-btn" onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>
                    <i class="fas fa-chevron-left"></i>
                </button>
            `;

            for (let i = 1; i <= pagination.totalPages; i++) {
                if (i === 1 || i === pagination.totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) {
                    html += `<button class="pagination-btn ${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">${i}</button>`;
                } else if (i === currentPage - 2 || i === currentPage + 2) {
                    html += '<span style="padding: 0 8px;">...</span>';
                }
            }

            html += `
                <button class="pagination-btn" onclick="changePage(${currentPage + 1})" ${currentPage === pagination.totalPages ? 'disabled' : ''}>
                    <i class="fas fa-chevron-right"></i>
                </button>
            `;

            container.innerHTML = html;
        }

        function changePage(page) {
            currentPage = page;
            loadDorms();
            window.scrollTo({ top: document.querySelector('.filter-section').offsetTop - 100, behavior: 'smooth' });
        }

        function generateSchema(data) {
            const schema = {
                "@context": "https://schema.org",
                "@type": "Place",
                "name": `${data.city} Student Housing`,
                "description": data.metaDescription,
                "address": {
                    "@type": "PostalAddress",
                    "addressLocality": data.city,
                    "addressCountry": "MA"
                }
            };

            document.getElementById('page-schema').textContent = JSON.stringify(schema);
        }

        function toggleFavorite(dormId) {
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            if (!user._id) {
                alert('Please sign in to save favorites');
                window.location.href = 'login.html';
                return;
            }
            // Toggle favorite logic
            console.log('Toggle favorite:', dormId);
        }

        // Demo data for development
        function showDemoData() {
            const demoData = {
                city: 'Casablanca',
                totalListings: 156,
                averagePrice: 3500,
                medianPrice: 3200,
                popularType: 'Studio',
                universities: [
                    { name: 'Hassan II University', slug: 'hassan-ii', dormCount: 45 },
                    { name: 'ISCAE', slug: 'iscae', dormCount: 23 },
                    { name: 'ENA', slug: 'ena', dormCount: 18 }
                ],
                neighborhoods: [
                    { name: 'Maarif', slug: 'maarif' },
                    { name: 'Anfa', slug: 'anfa' },
                    { name: 'Hay Hassani', slug: 'hay-hassani' },
                    { name: 'Ain Sebaa', slug: 'ain-sebaa' },
                    { name: 'Sidi Bernoussi', slug: 'sidi-bernoussi' },
                    { name: 'Medina', slug: 'medina' }
                ],
                metaTitle: 'Casablanca Student Housing - 156+ Verified Listings | RoastMyDorm',
                metaDescription: 'Find affordable student housing in Casablanca near Hassan II University, ISCAE, and more. Browse 156+ verified dorms and apartments.'
            };

            cityData = demoData;
            renderCityInfo(demoData);
            showDemoDorms();
        }

        function showDemoDorms() {
            const demoDorms = [
                { _id: '1', name: 'Modern Studio in Maarif', slug: 'modern-studio-maarif', neighborhood: 'Maarif', price: 3200, averageRating: 4.5, reviewCount: 12, amenities: ['WiFi', 'AC', 'Kitchen'], verified: true },
                { _id: '2', name: 'Cozy Room near ISCAE', slug: 'cozy-room-iscae', neighborhood: 'Anfa', price: 2800, averageRating: 4.2, reviewCount: 8, amenities: ['WiFi', 'Furnished'], featured: true },
                { _id: '3', name: 'Shared Apartment Hassan II', slug: 'shared-apartment-hassan', neighborhood: 'Hay Hassani', price: 2000, averageRating: 4.0, reviewCount: 15, amenities: ['WiFi', 'Laundry'] },
                { _id: '4', name: 'Budget Studio Ain Sebaa', slug: 'budget-studio-ain-sebaa', neighborhood: 'Ain Sebaa', price: 1800, averageRating: 3.8, reviewCount: 6, amenities: ['WiFi'] }
            ];

            renderDorms(demoDorms);
            renderPagination({ totalPages: 5 });
        }

        // Utility functions
        function formatPrice(price) {
            return new Intl.NumberFormat('fr-MA').format(price || 0);
        }

        function renderStars(rating) {
            const full = Math.floor(rating || 0);
            const half = rating % 1 >= 0.5 ? 1 : 0;
            const empty = 5 - full - half;
            
            return '★'.repeat(full) + (half ? '½' : '') + '☆'.repeat(empty);
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', loadCityData);
    </script>
</body>
</html>
